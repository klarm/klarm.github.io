<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>iOS 9新特性之分屏多任务 | klarm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="概述分屏多任务也许是iOS9最大的变化之一（目前只支持iPad Air 2），从具体形态上来说，其有3种表现形式：    

滑动覆盖 (Slide Over)：临时调出另一个程序，如写文档的过程中，临时弹出聊天窗口，短暂划出后关闭  
分割视图 (Split View)：真正的多任务，两个程序同时激活，两边的任务都可以进行实时操作，并且分屏比例可以调节
画中画模式 (Picture in Pic">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS 9新特性之分屏多任务">
<meta property="og:url" content="http://klarm.github.io/2015/07/19/iOS 9新特性之分屏多任务/index.html">
<meta property="og:site_name" content="klarm">
<meta property="og:description" content="概述分屏多任务也许是iOS9最大的变化之一（目前只支持iPad Air 2），从具体形态上来说，其有3种表现形式：    

滑动覆盖 (Slide Over)：临时调出另一个程序，如写文档的过程中，临时弹出聊天窗口，短暂划出后关闭  
分割视图 (Split View)：真正的多任务，两个程序同时激活，两边的任务都可以进行实时操作，并且分屏比例可以调节
画中画模式 (Picture in Pic">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E5%B1%8F%E5%B9%95%E5%88%92%E5%88%86.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E5%B1%8F%E5%B9%95%E5%88%92%E5%88%862.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E6%97%8B%E8%BD%AC%E5%B1%8F%E5%B9%95%E7%9A%84%E5%9B%9E%E8%B0%83.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E5%93%8D%E5%BA%94%E5%B1%8F%E5%B9%95%E5%8F%98%E5%8C%96.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/guideline.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/best%20practice.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP4.png">
<meta property="og:updated_time" content="2015-11-15T12:18:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS 9新特性之分屏多任务">
<meta name="twitter:description" content="概述分屏多任务也许是iOS9最大的变化之一（目前只支持iPad Air 2），从具体形态上来说，其有3种表现形式：    

滑动覆盖 (Slide Over)：临时调出另一个程序，如写文档的过程中，临时弹出聊天窗口，短暂划出后关闭  
分割视图 (Split View)：真正的多任务，两个程序同时激活，两边的任务都可以进行实时操作，并且分屏比例可以调节
画中画模式 (Picture in Pic">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
  
  <link href="//fonts.googleapis.com/css?family=Inconsolata:400,700|Open+Sans:700,400" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <div id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <div id="header-title">
        <h1 id="logo-wrap">
          <a href="/" id="logo">klarm
          
              <span id="subtitle">写写文字，记录所学、所想...</span>
          
          </a>
        </h1>
      </div>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://klarm.github.io"></form>
      </div>
    </div>
  </div>
</div>
      <div class="outer">
        <section id="main"><article id="post-iOS 9新特性之分屏多任务" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/19/iOS 9新特性之分屏多任务/" class="article-date">
  <time datetime="2015-07-18T16:00:00.000Z" itemprop="datePublished">2015-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      iOS 9新特性之分屏多任务
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="概述">概述</h2><p>分屏多任务也许是iOS9最大的变化之一（目前只支持iPad Air 2），从具体形态上来说，其有3种表现形式：    </p>
<ul>
<li>滑动覆盖 (Slide Over)：临时调出另一个程序，如写文档的过程中，临时弹出聊天窗口，短暂划出后关闭  </li>
<li>分割视图 (Split View)：真正的多任务，两个程序同时激活，两边的任务都可以进行实时操作，并且分屏比例可以调节</li>
<li>画中画模式 (Picture in Picture)：视频在一个悬浮小窗口中播放，类似于以前的弹窗播放  <h3 id="背景知识">背景知识</h3>屏幕适配经历了代码计算frame -&gt; auto resizing(父控件和子控件的关系ios6) -&gt; auto layout(任何控件都可以产生关系ios7) 的演变过程，为了解决适配更丰富屏幕的问题，在iOS8中，引入了一个全新的概念，这就是Size Class，不再根据设备屏幕的具体尺寸来进行区分，也淡化了横屏和竖屏的概念，而是通过它们的感官表现，在每个方向将其分为普通 (Regular) 和紧密(Compact) 两个类别，主流设备在不同方向下的分类如下：<br>iPhone4S,iPhone5/5s,iPhone6<br>竖屏：(w:Compact h:Regular)<br>横屏：(w:Compact h:Compact)<br>iPhone6 Plus<br>竖屏：(w:Compact h:Regular)<br>横屏：(w:Regular h:Compact)<br>iPad<br>竖屏：(w:Regular h:Regular)<br>横屏：(w:Regular h:Regular)<br>上述可以总结为下图：<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E5%B1%8F%E5%B9%95%E5%88%92%E5%88%86.png" alt=""><br>在iPad上，iOS 9引入分割视图以后，可以通过调节分割视图的分割条来调节各子区域的大小。设备在横屏或竖屏的情况下，分割条拖到不同的位置，各区域的Size Class定义如下图所示：<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E5%B1%8F%E5%B9%95%E5%88%92%E5%88%862.png" alt=""><br>引入Size Class最大的好处：<br>1、所有不同设备屏幕统一；<br>2、所有改变Window大小的行为统一（滑动分割窗口、旋转设备方向都统一为Size Class的变化）；<br>在上述思想下，  </li>
</ul>
<ul>
<li>willRotateToInterfaceOrientation:duration:</li>
<li>willAnimateRotationToInterfaceOrientation:duration:</li>
<li>didRotateFromInterfaceOrientation:</li>
<li>shouldAutomaticallyForwardRotationMethods<br>等与旋转有关的方法都将在8.0之后废弃，全部统一到-willTransitionToTraitCollection:withTransitionCoordinator: 和 -viewWillTransitionToSize:withTransitionCoordinator:，今后在程序代码层面将不再有旋转的概念，旋转与设备尺寸变化及分割窗口尺寸变化统一归结为Size Class的变化，这也是Size Class的设计哲学。  <h3 id="滑动覆盖_(Slide_Over)、分割视图_(Split_View)的适配方法">滑动覆盖 (Slide Over)、分割视图 (Split View)的适配方法</h3>官方文档：“Most apps should adopt Slide Over and Split View”<br>即在iOS9时代，滑动覆盖和分割视图是很基本的特性，多数app需要支持。<br>下图显示了旋转屏幕的过程中， ViewController收到的一系列的消息<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E6%97%8B%E8%BD%AC%E5%B1%8F%E5%B9%95%E7%9A%84%E5%9B%9E%E8%B0%83.png" alt=""><br>注意其中的Size Class变化对应的消息。 </li>
</ul>
<p>开发者根据当前工作的 UIViewController 的 traitCollection 属性来设置合适的布局，并且在 -willTransitionToTraitCollection:withTransitionCoordinator: 和 -viewWillTransitionToSize:withTransitionCoordinator: 被调用时对 UI 布局做出正确的响应。如下图所示：<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/%E5%93%8D%E5%BA%94%E5%B1%8F%E5%B9%95%E5%8F%98%E5%8C%96.png" alt=""></p>
<h3 id="需要注意的问题">需要注意的问题</h3><ul>
<li>在分屏的情况下UIScreen.bounds和UIWindow.bounds可能不同，后者可能是前者的一半或者三分之一。</li>
<li>iPad的Size Class可能会发生变化。在iOS 8时代，iPad不论横屏还是竖屏，长宽都是Regular的，但是在iOS 9引入分屏之后，就会有多种情况（见上图）。总之，iOS 9时代不要对Size Class和Window Size做任何假定，因为你的app可能被作为从属app打开，你的app也可以作为主app打开其它从属app，并且在上述过程中用户还可以进行拖动，导致Size Class有各种组合，解决的办法是使你的app支持所有方向和相应方向对应的Size Class的组合。<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/guideline.png" alt=""></li>
<li>分屏情况下，用户移动分割条，系统回调delegate的applicationWillResignActive:方法，注意在这个过程中不要丢失相关信息，保证用户释放分隔条时，如果app窗口大小和原来一致，程序的状态（文本选择范围、滚动条位置等）和最初一致。</li>
<li>分屏情况下，如果用户将分隔条从左侧滑动到最右侧，系统回调被完全覆盖的app的delegate的applicationDidEnterBackground:方法。<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/best%20practice.png" alt=""><h3 id="画中画模式_(Picture_in_Picture)">画中画模式 (Picture in Picture)</h3>官方文档：“Picture in Picture (PiP) is for apps whose primary role is video playback. And PiP is best for playback of medium-to-long duration content”<br>我的理解是PiP特性需要根据app所在的行业特点来决定是否应该支持，对于播放类的应用，最好都能支持。 </li>
</ul>
<p>在iOS9中，下面3个框架支持画中画模式：<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP1.png" alt=""><br>具体来说，根据下面的步骤来适配：<br>1、使用iOS 9 SDK；<br>2、在工程配置中，打开后台模式；<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP2.png" alt=""><br>3、将AudioSession的Catogory 设置为合适的选项，比如 AVAudioSessionCategoryPlayback；<br>4、如果使用的是AVPlayerViewController来播放视频，上述配置后进入全屏播放就支持画中画模式；<br>5、如果使用AVPlayerLayer来构造自定义播放界面，需要使用AVPlayerLayer 来创建一个 AVPictureInPictureController：</p>
<p><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP3.png" alt=""><br>AVPictureInPictureController提供了判断是否支持画中画模式、进入画中画模式、退出画中画模式的API：<br><img src="https://raw.githubusercontent.com/klarm/blog/master/for-iOS9/PiP4.png" alt=""><br>此外，AVPictureInPictureControllerDelegate<br>还提供了一些回调方法来获取画中画的执行情况，如：<br>pictureInPictureControllerDidStartPictureInPicture<br>pictureInPictureControllerFailedToStartPictureInPicture<br>pictureInPictureControllerWillStopPictureInPicture<br>可以根据这些回调通知做一些业务性的功能。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://klarm.github.io/2015/07/19/iOS 9新特性之分屏多任务/" data-id="cih0id5nw0003id3cy5kqk65u" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/07/20/iOS 9新特性之应用瘦身-app-thinning/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          iOS 9新特性之应用瘦身(App thinning)
        
      </div>
    </a>
  
  
    <a href="/2015/07/17/EGOTableViewPullRefresh解析/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">EGOTableViewPullRefresh解析</div>
    </a>
  
</nav>

  
</article>

</section>
        
          
            <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget recents">
      <ul>
        
          <li>
            <a href="/2015/11/15/iOS开发之Link Map File/">iOS开发之Link Map File</a>
          </li>
        
          <li>
            <a href="/2015/07/20/iOS 9新特性之应用瘦身-app-thinning/">iOS 9新特性之应用瘦身(App thinning)</a>
          </li>
        
          <li>
            <a href="/2015/07/19/iOS 9新特性之分屏多任务/">iOS 9新特性之分屏多任务</a>
          </li>
        
          <li>
            <a href="/2015/07/17/EGOTableViewPullRefresh解析/">EGOTableViewPullRefresh解析</a>
          </li>
        
          <li>
            <a href="/2015/03/01/for-SDWebImage/">SDWebImage解析</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
          
        
      </div>
      <div id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a></br>
      &copy; 2015 klarm<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</div>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>